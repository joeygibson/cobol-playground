IDENTIFICATION DIVISION.
PROGRAM-ID. PCRE-PROGRAM.
DATA DIVISION.
WORKING-STORAGE SECTION.
01 PATTERN-STRING POINTER.
01 SUBJECT-STRING POINTER.
01 OVECTOR POINTER.
01 OVECTOR-SIZE PIC S9(4) COMP VALUE 30.
01 RETURN-CODE PIC S9(4) COMP.
01 CAPTURE-GROUPS OCCURS 10 TIMES.
   05 CAPTURE-START PIC S9(4) COMP.
   05 CAPTURE-END PIC S9(4) COMP.
   05 CAPTURE-LENGTH PIC S9(4) COMP.

LINKAGE SECTION.
01 PATTERN-LEN PIC S9(4) COMP.
01 SUBJECT-LEN PIC S9(4) COMP.

PROCEDURE DIVISION.
   LINKAGE SECTION.
   PROCEDURE DIVISION USING PATTERN-STRING, PATTERN-LEN,
                             SUBJECT-STRING, SUBJECT-LEN.

   CALL "pcre_exec" USING BY REFERENCE PATTERN-STRING
                        BY VALUE PATTERN-LEN
                        BY REFERENCE SUBJECT-STRING
                        BY VALUE SUBJECT-LEN
                        BY VALUE 0
                        BY REFERENCE OVECTOR
                        BY VALUE OVECTOR-SIZE
                        BY REFERENCE RETURN-CODE.

   IF RETURN-CODE > 0
       MOVE RETURN-CODE TO CAPTURE-GROUPS(1:1).  // Number of capture groups

       PERFORM VARYING I FROM 1 BY 1 UNTIL I > RETURN-CODE
           COMPUTE CAPTURE-START(I) = OVECTOR((I - 1) * 2) + 1
           COMPUTE CAPTURE-END(I) = OVECTOR((I * 2) - 1)
           COMPUTE CAPTURE-LENGTH(I) = CAPTURE-END(I) - CAPTURE-START(I) + 1
       END-PERFORM
   END-IF

   DISPLAY "Capture groups:"
   PERFORM VARYING I FROM 1 BY 1 UNTIL I > CAPTURE-GROUPS(1:1)
       DISPLAY "Group" I ":"
       DISPLAY "Start: " CAPTURE-START(I)
       DISPLAY "End: " CAPTURE-END(I)
       DISPLAY "Length: " CAPTURE-LENGTH(I)
   END-PERFORM

   STOP RUN.
